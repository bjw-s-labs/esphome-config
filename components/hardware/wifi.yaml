---
# Wi-Fi component package
# https://esphome.io/components/wifi.html
#

substitutions:
  wifi_ssid: !secret wifi_ssid
  wifi_password: !secret wifi_pwd
  wifi_ap_password: !secret wifi_fallback_ssid_password
  host_name: "${host_name}"

wifi:
  id: component_wifi
  ssid: "${wifi_ssid}"
  use_address: "${host_name}"
  password: "${wifi_password}"
  reboot_timeout: 10min
  ap:
    ssid: "${friendly_name}"
    password: "${wifi_ap_password}"

sensor:
  - platform: template
    id: sensor_wifi_signal_percentage
    name: "WiFi Signal Percentage"
    icon: "mdi:wifi"
    unit_of_measurement: "%"
    update_interval: never
    entity_category: "diagnostic"
    lambda: |-
      if (id(sensor_wifi_signal).state) {
        if (id(sensor_wifi_signal).state <= -100 ) {
          return 0;
        } else if (id(sensor_wifi_signal).state >= -50) {
          return 100;
        } else {
          return 2 * (id(sensor_wifi_signal).state + 100);
        }
      } else {
        return NAN;
      }

  - platform: wifi_signal
    id: sensor_wifi_signal
    name: "WiFi Signal"
    update_interval: 300s
    entity_category: "diagnostic"
    on_value:
      - component.update: sensor_wifi_signal_percentage

text_sensor:
  - platform: wifi_info
    ip_address:
      name: "IP Address"
    ssid:
      name: "Connected SSID"
    mac_address:
      name: "Connected MAC"
